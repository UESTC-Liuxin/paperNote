# 语义分割评价指标以及代码

对于像素级别的分类，最常用的评价指标是Pixel Accuracy（像素准确率，同时也叫Overall Accuracy）和Mean Inetersection over Union（平均交并比），二者的计算都是建立在混淆矩阵的基础上的。因此首先来介绍一下混淆矩阵，之后分别介绍PA，MPA，MIoU，FWIoU，最后附上代码实现。

## 混淆矩阵

首先假定数据集中有n+1类（0~n），0通常表示背景。使用Pii表示像素点原本为i类同时预测为i类，即真正（TP）和真负（TN）, Pij表示原本为i类被预测为j类，即假正（FP）和假负（FN），如果第i类为正类，i!=j时，那么Pii表示TP，Pjj表示TN，Pij表示FP，Pji表示FN。

| gt\pred(括号内为gt中不同类别总的像素点) | 0    | 1    | 2    |
| --------------------------------------- | ---- | ---- | ---- |
| 0（300）                                | 220  | 40   | 40   |
| 1（200）                                | 10   | 160  | 30   |
| 2 （100）                               | 20   | 30   | 50   |

## 像素准确率(PA)

PA（或者叫做OA，像素准确率是所有分类正确的像素数占像素总数的比例），计算公式如下：

<img src="https://img2018.cnblogs.com/i-beta/1823231/201911/1823231-20191106170633023-157833346.png" alt="img" style="zoom:50%;" />

==利用混淆矩阵计算则为（对角线元素之和除以矩阵所有元素之和== 

那么此时PA=(220+160+50)/600=0.7166

## 平均像素准确率(MPA,mAcc)

平均像素准确率是分别计算**每个类别分类正确的像素数占所有预测为该类别像素数的比例**，即精确率，然后累加求平均。公式化如下：

<img src="https://img2018.cnblogs.com/i-beta/1823231/201911/1823231-20191107171207727-248746638.png" alt="img" style="zoom: 33%;" />

==利用混淆矩阵计算公式为(每一类的精确率Pi都等于对角线上的TP除以对应列的像素数)==

此时，mAcc=(220/300+160/200+50/100)/3=0.67778

##  平均交并比(mloU)

平均交并比是对每一类预测的结果和真实值的交集与并集的比值求和平均的结果。公式化如下：

<img src="https://piggo1996.oss-cn-beijing.aliyuncs.com/img/1823231-20191106171906220-1306476030.png" alt="img" style="zoom: 67%;" />

　IoU利用混淆矩阵计算:

![img](https://piggo1996.oss-cn-beijing.aliyuncs.com/img/1823231-20191106190830934-1232807193.png)

==具体的就是将对角线所在的点也就是Pii，除以整个列和整个行加起来减Pii，取平均==

对于一个类别0来说：

Iou=220/(250+300-220)=0.667

解释如下：

如图所示，仅仅针对某一类来说，红色部分代表真实值，真实值有两部分组成TP,FN；黄色部分代表预测值，预测值有两部分组成TP,FP；白色部分代表TN（真负）；所以他们的交集就是TP+FP+FN，并集为TP

<img src="https://piggo1996.oss-cn-beijing.aliyuncs.com/img/1823231-20191106183932585-2115877255.png" alt="img" style="zoom: 50%;" />

## 频权交并比（FWIoU）

<img src="https://piggo1996.oss-cn-beijing.aliyuncs.com/img/20200909202557584.png" alt="在这里插入图片描述" style="zoom: 67%;" />

==实际上就是按照gt当中每个类别的比例对IOU进行加权相加。==

![在这里插入图片描述](https://piggo1996.oss-cn-beijing.aliyuncs.com/img/20200909202635102.png)

IoU(0)=0.667

IoU(1)=160/(200+230-160)=0.592

IoU(2)=50/(100+120-50)=0.294

FwIoU=0.5\*0.667+0.333\*0.592+0.167*0.294=0.594

